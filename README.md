# 相机标定工具 (Camera Calibration Tool)

这是一个基于张正友标定法实现的相机标定工具，使用OpenCV和Eigen库进行开发。该工具可以通过检测棋盘格图案来标定相机的内参和畸变参数，并提供实时去畸变预览功能。

## 功能特性

- 实时检测棋盘格图案
- 自动采样优化（避免采集相似姿态的样本）
- 基于张正友标定法计算相机内参和径向畸变参数
- 实时去畸变预览
- 支持将标定结果保存为YAML格式文件

## 依赖项

- OpenCV 3.0 或更高版本
- Eigen3
- CMake 3.10 或更高版本
- C++20 兼容编译器

## 编译说明

```bash
mkdir build
cd build
cmake ..
make
```

## 使用方法

### 基本用法

```bash
./calibrateCamera <cols> <rows> <square_size>
```

参数说明：
- `cols`: 棋盘格列数（横向角点数）
- `rows`: 棋盘格行数（纵向角点数）
- `square_size`: 棋盘格每个方格的边长（单位：毫米或其他一致单位）

例如，对于一个8x6的棋盘格，每个方格边长为25mm：
```bash
./calibrateCamera 8 6 25
```

### 操作指南

运行程序后，将显示两个窗口：
1. `live`: 实时摄像头画面，带有棋盘格检测结果和操作提示
2. `undistorted`: 去畸变后的画面（标定完成后显示）

界面中的进度条显示了样本在各个维度上的覆盖情况：
- X-pos: X方向位置覆盖度
- Y-pos: Y方向位置覆盖度
- Size: 尺寸覆盖度
- Skew: 倾斜度覆盖度

键盘操作：
- `a`: 切换自动采样模式开/关
- `s`: 手动保存当前帧作为标定样本
- `c`: 开始标定计算
- `w`: 将标定结果写入YAML文件
- `q` 或 `ESC`: 退出程序

### 自动采样模式

为了获得更好的标定效果，程序实现了自动采样机制。该机制会评估每帧棋盘格的姿态（位置、大小、倾斜度），只保留与已有样本差异较大的新样本，避免采集过多相似姿态的样本。

## 输出文件

标定完成后，可以按`w`键将结果保存为`camera_param.yaml`文件，包含以下信息：
- `image_width`: 图像宽度
- `image_height`: 图像高度
- `camera_matrix`: 相机内参矩阵
- `distortion_coefficients`: 畸变系数

## 算法原理

本工具采用张正友标定法（Zhang's Method）：

1. 通过DLT算法计算每一帧的单应性矩阵
2. 利用单应性矩阵之间的约束关系求解相机内参
3. 计算每帧的外参（旋转和平移）
4. 估计径向畸变参数

## 注意事项

1. 棋盘格需要打印并贴在平整的表面上
2. 采集样本时应尽量覆盖不同的位置、角度和尺度
3. 建议采集10-20帧样本以获得较好的标定效果
4. 标定时至少需要3帧样本